---
title: "medicare"
author: "luciana"
date: "10/24/2019"
output: html_document:
    toc: true
    toc_depth: 3
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}


library(tidyverse)
library(janitor)
library(arcos)
library(scales)
library(ggrepel)
library(tidycensus)

```


```{r}
#arcos key 

# store one of our API keys as an object called key
key <- "uO4EK6I"
```

  
```{r}
# load arcos and clean names 
arcos_county_pills_per_year <- summarized_county_annual(key = key) %>%
  clean_names()

```

```{r}

# pills 

#pills_all_years <-

 pills_2012 <- arcos_county_pills_per_year %>% 
  filter(year=="2012") %>% select( buyer_state, buyer_county , countyfips , dosage_unit )



# population 2012 

county_population_2012 <- county_population(key = key) %>% clean_names() %>%select(buyer_state, buyer_county, countyfips, population, year) %>% filter(year =="2012")


```


```{r}
#anti join to see which one are not in arcos county pills 
#county_population_2012 has 3143
#pills_2012 has 3089 rows 

# 136 records in our population table without a countyfips match in our pills table
not_in_pills_2012 <- county_population_2012 %>%
  anti_join(pills_2012, by=c("countyfips")) 

#not year match as all are 2012 

# 82 records in our pills table without a countyfips match in population table.  
not_in_population_2012 <- pills_2012 %>%
  anti_join(county_population_2012, by=c("countyfips"))

``` 

```{r}

county_pills_2012_per_person <- pills_2012 %>%
  left_join(county_population_2012, by = c("countyfips", "buyer_county","buyer_state"))%>%  
  mutate(pills_per_person = dosage_unit/population) 


```

``` {r}

county_pills_2012_per_person %>% filter(pills_per_person > 100)



```

```{r}

#The Centers for Medicare & Medicaid Services (CMS) has prepared a public data set, the Medicare Part D Opioid Prescriber Summary File, which presents information on the individual opioid prescribing rates of health providers that participate in Medicare Part D program. This file is a prescriber-level data set that provides data on the number and percentage of prescription claims (includes new prescriptions and refills) for opioid drugs, and contains information on each providerâ€™s name, specialty, state, and ZIP code.

# This summary file was derived from the 2013 Part D Prescriber Summary Table (Documentation available at: https://www.cms.gov/Research-Statistics-Data-and-Systems/Statistics-Trends-and-Reports/Medicare-Provider-Charge-Data/Downloads/Prescriber_Methods.pdf)


# 2013 database - https://data.cms.gov/Medicare-Part-D/Medicare-Part-D-Opioid-Prescriber-Summary-File-201/yb2j-f3fp


 Medicare_Part_D_Opioid_Prescriber_Summary_File_2013 <- Medicare_Part_D_Opioid_Prescriber_Summary_File_2013%>%
  clean_names()




```


```{r}

medicare_edited <- Medicare_Part_D_Opioid_Prescriber_Summary_File_2013%>%filter(opioid_prescribing_rate >50)%>%select(nppes_provider_first_name,nppes_provider_first_name,nppes_provider_zip_code,nppes_provider_state,specialty_description,total_claim_count,opioid_claim_count,opioid_prescribing_rate,long_acting_opioid_claim_count,long_acting_opioid_prescribing_rate)%>%print(medicare_edited)
 
```

```{r}

medicare_edited %>% arrange(desc(opioid_prescribing_rate))%>%filter(opioid_claim_count>100)


```

```{r}
medicare_edited %>% arrange(desc(opioid_prescribing_rate))%>%filter(opioid_claim_count>100)%>%count(specialty_description)

```
